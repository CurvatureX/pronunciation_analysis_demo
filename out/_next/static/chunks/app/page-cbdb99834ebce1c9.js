(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{76916:function(){},79271:function(){},42104:function(){},14151:function(){},84270:function(){},22914:function(){},22088:function(){},51524:function(e,t,s){Promise.resolve().then(s.bind(s,57340))},57340:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(57437),r=s(2265),n=s(48662),i=s(60730),c=s(89227),o=s(33276),l=s(69076),d=s(81706),u=s(86595),m=s(65302),p=s(64972),x=s(82023),h=s(60429),f=s(5095),y=s(84631);function g(){var e;let[t,s]=(0,r.useState)(!1),[g,w]=(0,r.useState)(!1),[b,v]=(0,r.useState)(null),[j,N]=(0,r.useState)(null),[A,S]=(0,r.useState)(!1),[k,E]=(0,r.useState)(!1),[R,P]=(0,r.useState)(0),[C,U]=(0,r.useState)(0),I=(0,r.useRef)(null),T=(0,r.useRef)(null),M=(0,r.useRef)(null),[z,D]=(0,r.useState)(Array(40).fill(0));(0,r.useEffect)(()=>(t?M.current=setInterval(()=>{U(e=>e+1),P(100*Math.random()),D(e=>e.map(()=>100*Math.random()))},100):(M.current&&clearInterval(M.current),P(0)),()=>{M.current&&clearInterval(M.current)}),[t]);let F=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0}}),t="audio/wav";MediaRecorder.isTypeSupported(t)||(t=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4","audio/mpeg"].find(e=>MediaRecorder.isTypeSupported(e))||"audio/webm");let a=new MediaRecorder(e,{mimeType:t,audioBitsPerSecond:128e3});I.current=a;let r=[];a.ondataavailable=e=>{r.push(e.data)},a.onstop=async()=>{let s=new Blob(r,{type:t}),a=s;if(!t.includes("wav"))try{a=await _(s)}catch(e){console.warn("WAV conversion failed, using original format:",e)}let n=URL.createObjectURL(a);v(n),e.getTracks().forEach(e=>e.stop())},a.start(),s(!0),U(0)}catch(e){console.error("Error accessing microphone:",e),alert("Please allow microphone access to record audio.")}},_=async e=>new Promise((t,s)=>{let a=new AudioContext({sampleRate:16e3}),r=new FileReader;r.onload=async()=>{try{let e=r.result,s=await a.decodeAudioData(e),n=O(s),i=new Blob([n],{type:"audio/wav"});t(i)}catch(e){s(e)}},r.onerror=()=>s(r.error),r.readAsArrayBuffer(e)}),O=e=>{let t=e.length,s=e.sampleRate,a=new ArrayBuffer(44+2*t),r=new DataView(a),n=(e,t)=>{for(let s=0;s<t.length;s++)r.setUint8(e+s,t.charCodeAt(s))};n(0,"RIFF"),r.setUint32(4,36+2*t,!0),n(8,"WAVE"),n(12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,s,!0),r.setUint32(28,2*s,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),n(36,"data"),r.setUint32(40,2*t,!0);let i=e.getChannelData(0),c=44;for(let e=0;e<t;e++){let t=Math.max(-1,Math.min(1,i[e]));r.setInt16(c,t<0?32768*t:32767*t,!0),c+=2}return a},Z=async()=>{if(b){S(!0);try{let i="8WzvsXMuvoyP56mWnjhVrJX0YgMaZvHUKdPKz0gIiDrQcb1sRYu2JQQJ99BFACi0881XJ3w3AAAYACOGhyVT",c="japaneast";if(!i||!c)throw Error("Azure Speech Service not configured. Please set NEXT_PUBLIC_AZURE_SPEECH_KEY and NEXT_PUBLIC_AZURE_SPEECH_REGION in your .env.local file.");let o=await fetch(b),l=await o.blob(),d=await l.arrayBuffer(),u=y.SpeechConfig.fromSubscription(i,c);u.speechRecognitionLanguage="en-US";let m=y.AudioInputStream.createPushStream();m.write(d),m.close();let p=y.AudioConfig.fromStreamInput(m),x=new y.PronunciationAssessmentConfig("",y.PronunciationAssessmentGradingSystem.HundredMark,y.PronunciationAssessmentGranularity.Phoneme,!1),h=new y.SpeechRecognizer(u,p);x.applyTo(h);let f=await new Promise((e,t)=>{h.recognizeOnceAsync(t=>{h.close(),e(t)},e=>{h.close(),t(Error(e))})});if(f.reason===y.ResultReason.RecognizedSpeech){var e,t,s,a,r,n;let i=y.PronunciationAssessmentResult.fromResult(f),c=f.properties.getProperty(y.PropertyId.SpeechServiceResponse_JsonResult),o=JSON.parse(c),l={detectedText:f.text,userTranscript:f.text,scores:{overall:Math.round(i.pronunciationScore||0),accuracy:Math.round(i.accuracyScore||0),fluency:Math.round(i.fluencyScore||0),completeness:Math.round(i.completenessScore||0)},wordFeedback:(null===(s=o.NBest)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:null===(e=t.Words)||void 0===e?void 0:e.map((e,t)=>{var s,a,r;return{word:e.Word,score:Math.round((null===(s=e.PronunciationAssessment)||void 0===s?void 0:s.AccuracyScore)||0),feedback:B((null===(a=e.PronunciationAssessment)||void 0===a?void 0:a.AccuracyScore)||0,(null===(r=e.PronunciationAssessment)||void 0===r?void 0:r.ErrorType)||"Unknown"),position:t}}))||[],audioUrl:b,rawApiResponse:o};N(l),E(!0);try{let e=await fetch("".concat("https://api.deepseek.com/v1","/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("sk-85c12c5754984b26807190448a5f9d8a")},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"你是一位热情洋溢、经验丰富的英语口语老师，深受学生喜爱！你的任务是根据提供的语音分析API响应数据，为学生制定一个生动、简洁、针对性的英语口语提升计划。\n\nAPI数据包含学生的口语文本、发音准确性（AccuracyScore）、流利度（FluencyScore）、完整度（CompletenessScore）、总体发音得分（PronScore），以及每个单词、音节和音素的发音评估。\n\n请深入分析数据，找出学生在发音、流利度或语调方面的关键问题，以亲切、鼓励且充满活力的英语老师口吻，提出3-4条具体、可操作的改进建议。\n\n计划应简洁（100字以内），用生动的语言激励学生，包含实用练习方法，确保学生感到被支持并跃跃欲试。避免枯燥的术语，用类比或有趣的表达让建议更吸引人！\n\n请用中文回答。"},{role:"user",content:"API数据：".concat(JSON.stringify(o,null,2))}],temperature:.7,max_tokens:800})});if(e.ok){let t=await e.json(),s=null===(n=t.choices)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:null===(a=r.message)||void 0===a?void 0:a.content;s&&N(e=>e?{...e,aiAnalysis:s}:l)}}catch(e){console.warn("AI analysis failed:",e),N(e=>e?{...e,aiAnalysis:"嘿，语言探索者！\uD83C\uDF1F 虽然AI老师暂时在休息，但我依然要为你点赞！\n\n\uD83D\uDCA1 **继续练习**：保持每天录音的好习惯，语言就像肌肉，越练越强！\n\uD83C\uDFAF **专注发音**：挑选几个挑战词汇，重复练习直到完美！\n\uD83C\uDFB5 **模仿跟读**：找你喜欢的英语内容，像学歌一样跟着唱！\n✨ **保持自信**：每一次开口都是进步，你已经在正确的道路上了！\n\n记住，流利英语不是一日建成的城堡，而是每日积累的美丽花园！\uD83C\uDF38"}:l)}finally{E(!1)}}else throw Error("Speech recognition failed: ".concat(y.ResultReason[f.reason]))}catch(e){console.error("Analysis error:",e),N({detectedText:"Azure Error - Using mock data",userTranscript:"Azure Error - Using mock data",scores:{overall:85,accuracy:82,fluency:88,completeness:85},wordFeedback:[{word:"Azure",score:50,feedback:"Check Azure Speech Service configuration",position:0},{word:"Error:",score:50,feedback:e instanceof Error?e.message:"Unknown error",position:1}],audioUrl:b,error:e instanceof Error?e.message:"Unknown error"})}finally{S(!1)}}},B=(e,t)=>"Omission"===t?"Word was not pronounced":"Insertion"===t?"Extra word detected":"Mispronunciation"===t?"Pronunciation needs improvement":e>=90?"Excellent pronunciation":e>=80?"Good pronunciation":e>=70?"Acceptable, could be clearer":e>=60?"Needs improvement":"Significant improvement needed",J=e=>e>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600",H=e=>e>=90?"bg-green-100":e>=70?"bg-yellow-100":"bg-red-100";return(0,a.jsx)("div",{className:"min-h-screen p-4 sm:p-6 lg:p-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)(h.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-800 mb-4",children:"AI Pronunciation Analysis"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Record your speech and let Azure AI automatically detect what you said and analyze your pronunciation. No target sentence needed - just speak naturally!"})]}),(0,a.jsx)(h.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.1},className:"feedback-card mb-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mb-6",children:t&&(0,a.jsxs)(h.E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center mb-4",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full recording-pulse mr-2"}),(0,a.jsxs)("span",{className:"text-red-600 font-medium",children:["Recording: ",(e=Math.floor(C/10),"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")))]})]})}),(t||b)&&(0,a.jsx)(h.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-end justify-center space-x-1 mb-6 h-16",children:z.map((e,s)=>(0,a.jsx)(h.E.div,{className:"waveform-bar",style:{height:"".concat(Math.max(4,.6*e),"px"),width:"4px",opacity:t?1:.5},animate:{height:t?"".concat(Math.max(4,.6*e),"px"):"4px"}},s))}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[t?(0,a.jsxs)(h.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{I.current&&t&&(I.current.stop(),s(!1))},className:"flex items-center px-6 py-3 bg-red-500 text-white rounded-full font-medium hover:bg-red-600 transition-colors shadow-lg",children:[(0,a.jsx)(i.Z,{className:"mr-2 h-5 w-5"}),"Stop Recording"]}):(0,a.jsxs)(h.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:F,className:"flex items-center px-6 py-3 bg-primary-500 text-white rounded-full font-medium hover:bg-primary-600 transition-colors shadow-lg",children:[(0,a.jsx)(n.Z,{className:"mr-2 h-5 w-5"}),"Start Recording"]}),b&&!t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:g?()=>{T.current&&(T.current.pause(),w(!1))}:()=>{b&&(T.current&&(T.current.pause(),T.current.currentTime=0),T.current=new Audio(b),T.current.play(),w(!0),T.current.onended=()=>{w(!1)})},className:"flex items-center px-4 py-3 bg-gray-500 text-white rounded-full font-medium hover:bg-gray-600 transition-colors",children:[g?(0,a.jsx)(c.Z,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),g?"Pause":"Play"]}),(0,a.jsxs)(h.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{T.current&&T.current.pause(),v(null),N(null),w(!1),U(0),D(Array(40).fill(0))},className:"flex items-center px-4 py-3 bg-gray-400 text-white rounded-full font-medium hover:bg-gray-500 transition-colors",children:[(0,a.jsx)(l.Z,{className:"mr-2 h-4 w-4"}),"Reset"]}),(0,a.jsx)(h.E.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Z,disabled:A,className:"flex items-center px-6 py-3 bg-accent-500 text-white rounded-full font-medium hover:bg-accent-600 transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:A?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Analyzing..."]}):"Analyze Pronunciation"})]})]})]})}),(0,a.jsx)(f.M,{children:j&&(0,a.jsxs)(h.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"feedback-card",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[(0,a.jsx)(d.Z,{className:"mr-2 h-5 w-5 text-blue-500"}),"Detected Speech"]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500",children:[(0,a.jsxs)("p",{className:"text-lg text-gray-800 italic",children:["“",j.detectedText,"”"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"This is what Azure Speech Service automatically detected from your pronunciation"})]})]}),(0,a.jsxs)("div",{className:"feedback-card",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[(0,a.jsx)(u.Z,{className:"mr-2 h-5 w-5 text-yellow-500"}),"Pronunciation Scores"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:Object.entries(j.scores).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"text-center p-4 rounded-lg ".concat(H(s)),children:[(0,a.jsxs)("div",{className:"text-2xl font-bold ".concat(J(s)),children:[s,"%"]}),(0,a.jsx)("div",{className:"text-sm font-medium text-gray-600 capitalize",children:t})]},t)})})]}),(0,a.jsxs)("div",{className:"feedback-card",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[(0,a.jsx)(m.Z,{className:"mr-2 h-5 w-5 text-green-500"}),"Word Analysis"]}),(0,a.jsx)("div",{className:"space-y-3",children:j.wordFeedback.map((e,t)=>(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2 sm:mb-0",children:[(0,a.jsxs)("span",{className:"font-medium text-lg mr-3",children:["“",e.word,"”"]}),(0,a.jsxs)("span",{className:"text-sm font-bold ".concat(J(e.score)),children:[e.score,"%"]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.feedback})]},t))})]}),(k||j.aiAnalysis)&&(0,a.jsxs)("div",{className:"feedback-card",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[(0,a.jsx)(p.Z,{className:"mr-2 h-5 w-5 text-purple-500"}),"AI 口语老师的专业建议",(0,a.jsx)(x.Z,{className:"ml-2 h-4 w-4 text-yellow-500"}),k&&(0,a.jsx)("div",{className:"ml-2 animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500"})]}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border-l-4 border-purple-500",children:k?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500 mr-3"}),(0,a.jsx)("span",{className:"text-purple-700 font-medium",children:"AI老师正在分析您的发音，请稍候..."})]}):j.aiAnalysis?(0,a.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,a.jsx)("div",{className:"text-gray-800 leading-relaxed whitespace-pre-wrap",style:{fontSize:"16px",lineHeight:"1.6"},children:j.aiAnalysis})}):null}),(0,a.jsxs)("div",{className:"mt-3 text-xs text-gray-500 flex items-center",children:[(0,a.jsx)(p.Z,{className:"mr-1 h-3 w-3"}),k?"正在生成个性化指导...":"由 DeepSeek AI 提供的个性化指导"]})]}),(0,a.jsxs)("div",{className:"feedback-card",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"mr-2 text-purple-500 font-mono",children:"{}"}),"Backend Response (JSON)"]}),(0,a.jsx)("div",{className:"bg-gray-900 rounded-lg p-4 overflow-x-auto",children:(0,a.jsx)("pre",{className:"text-sm text-green-400 font-mono whitespace-pre-wrap",children:JSON.stringify(j.rawApiResponse||j,null,2)})}),(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:"This shows the raw JSON response from the pronunciation analysis API"})]})]})})]})})}}},function(e){e.O(0,[886,971,117,744],function(){return e(e.s=51524)}),_N_E=e.O()}]);